<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>greenhauL - Mudanzas Sostenibles</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="assets/css/styles.css">
    <link rel="stylesheet" href="assets/css/pages.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
</head>
<body>
    <header>
        <nav class="navbar">
            <div class="container navbar-content">
                <a href="index.html" class="logo">
                    <img src="assets/img/Greenhaul-fl.svg" alt="Logo de GreenHaul">
                </a>
                <button class="navbar-toggler" id="navbarToggler" aria-label="Toggle navigation">
                    <span class="toggler-icon"></span>
                    <span class="toggler-icon"></span>
                    <span class="toggler-icon"></span>
                </button>
                <div class="navbar-collapse" id="navbarCollapse">
                    <ul class="nav-links-list">
                        <li><a href="index.html" class="nav-link">Inicio</a></li>
                        <li><a href="productos.html" class="nav-link active">Productos</a></li>
                        <li><a href="servicios.html" class="nav-link">Servicios</a></li>
                        <li><a href="nosotros.html" class="nav-link">Nosotros</a></li>
                        <li><a href="contacto.html" class="nav-link">Contacto</a></li>
                        <li><a href="faq.html" class="nav-link">Preguntas</a></li>
                    </ul>
                    <div class="navbar-right-items">
                        <div class="navbar-user-actions" id="navbarUserActions">
                            <a href="login.html" class="btn btn-outline" id="loginBtn">Iniciar Sesión</a>
                            <a href="cuenta.html" class="nav-link" id="accountLink" style="display: none;">Hola, <span id="userName"></span></a>
                            <button class="btn-tertiary" id="logoutBtn" style="display: none;" title="Cerrar Sesión"><i class="fas fa-sign-out-alt"></i></button>
                        </div>
                        <div class="nav-icons">
                            <a href="#" class="nav-icon cart-icon" id="cartIcon">
                                <i class="fas fa-shopping-cart"></i>
                                <span class="cart-count" id="cartCount">0</span>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </nav>
    </header>
    <main class="page-content">
        <section class="section">
            <div class="container">
                <div class="section-title">
                    <h2>Nuestros <span class="highlight-sostenible">Productos</span></h2>
                    <p>Alquila nuestras cajas reutilizables y accesorios para una mudanza eficiente y ecológica.</p>
                </div>
                <div class="rental-dates-container" style="margin-bottom: 2.5rem;">
                    <div class="section-subtitle">
                        <h3>1. Elige tu período de renta</h3>
                        <p>Selecciona las fechas en que necesitas nuestros productos.<br>
                        <span style="font-size:0.97em;color:var(--accent-purple);">Las fechas se guardan automáticamente.</span></p>
                    </div>
                    <div class="date-fields" style="display: flex; gap: 2rem; flex-wrap: wrap;">
                        <div class="form-group">
                            <label for="fecha-entrega"><i class="fas fa-calendar-alt"></i> Fecha de Entrega</label>
                            <input type="date" id="fecha-entrega" name="fecha-entrega" class="form-control" autocomplete="off">
                        </div>
                        <div class="form-group">
                            <label for="fecha-recoleccion"><i class="fas fa-calendar-check"></i> Fecha de Recolección</label>
                            <input type="date" id="fecha-recoleccion" name="fecha-recoleccion" class="form-control" autocomplete="off">
                        </div>
                    </div>
                    <div id="dates-warning" style="color:var(--accent-red);margin-top:8px;display:none;"></div>
                </div>
                <div class="section-subtitle" style="margin-top:2rem;">
                    <h3>2. Selecciona tus productos</h3>
                </div>
                <div class="product-grid" style="gap:2rem;">

                    <!-- PAQUETE BÁSICO -->
                    <div class="product-card" data-product-id="101" data-product-price="79.00">
                        <div class="badge best-value">Paquete Básico</div>
                        <div class="product-image" style="font-size:2.5rem;">📦✨</div>
                        <div class="product-info">
                            <h3>Paquete Básico</h3>
                            <p class="description">¡Comienza tu mudanza con todo lo esencial! Este paquete incluye 5 cajas chicas y 5 cajas medianas, perfectas para mudanzas rápidas y seguras. <span style="color:var(--accent-green);">🌱</span></p>
                            <ul class="product-features">
                                <li>5 Cajas HDPE 15kg (chica) <span>🟩</span></li>
                                <li>5 Cajas Cozumel 20kg (mediana) <span>🟦</span></li>
                                <li>Plástico HDPE virgen, máxima resistencia y durabilidad</li>
                            </ul>
                            <div class="quantity-control">
                                <label for="qty-paq-basico">Cantidad:</label>
                                <select id="qty-paq-basico" class="product-qty form-control">
                                    <option value="" disabled selected>Selecciona</option>
                                    <option value="1">1</option>
                                    <option value="2">2</option>
                                </select>
                            </div>
                            <p class="price">$79.00 MXN <span>/día</span></p>
                            <button class="btn btn-primary add-to-cart-btn">Añadir al Carrito</button>
                        </div>
                    </div>
                    <!-- PAQUETE ESTÁNDAR -->
                    <div class="product-card" data-product-id="102" data-product-price="159.00">
                        <div class="badge popular">Paquete Estándar</div>
                        <div class="product-image" style="font-size:2.5rem;">🏠🔒</div>
                        <div class="product-info">
                            <h3>Paquete Estándar</h3>
                            <p class="description">¡Soluciona tu mudanza de tamaño medio! Incluye cajas chicas, medianas, grandes y un diablito para facilitar el traslado. Seguridad, espacio y comodidad. <span style="color:var(--accent-green);">🛡️</span></p>
                            <ul class="product-features">
                                <li>5 Cajas HDPE 15kg (chica) <span>🟩</span></li>
                                <li>5 Cajas Cozumel 20kg (mediana) <span>🟦</span></li>
                                <li>2 Cajas PP 30L (grande) <span>🟥</span></li>
                                <li>1 Diablito de carga <span>🛒</span></li>
                                <li>Ideal para casas y departamentos medianos</li>
                            </ul>
                            <div class="quantity-control">
                                <label for="qty-paq-estandar">Cantidad:</label>
                                <select id="qty-paq-estandar" class="product-qty form-control">
                                    <option value="" disabled selected>Selecciona</option>
                                    <option value="1">1</option>
                                    <option value="2">2</option>
                                </select>
                            </div>
                            <p class="price">$159.00 MXN <span>/día</span></p>
                            <button class="btn btn-primary add-to-cart-btn">Añadir al Carrito</button>
                        </div>
                    </div>
                    <!-- PAQUETE PREMIUM -->
                    <div class="product-card" data-product-id="103" data-product-price="249.00">
                        <div class="badge nuevo">Paquete Premium</div>
                        <div class="product-image" style="font-size:2.5rem;">🏡💎</div>
                        <div class="product-info">
                            <h3>Paquete Premium</h3>
                            <p class="description">¡La opción más completa y cómoda! Perfecto para mudanzas grandes, incluye todo lo necesario para proteger tus pertenencias. <span style="color:var(--accent-green);">🎁</span></p>
                            <ul class="product-features">
                                <li>10 Cajas HDPE 15kg (chica) <span>🟩</span></li>
                                <li>10 Cajas Cozumel 20kg (mediana) <span>🟦</span></li>
                                <li>5 Cajas PP 30L (grande) <span>🟥</span></li>
                                <li>2 Diablitos de carga <span>🛒</span></li>
                                <li>2 Cobijas de mudanza <span>🧺</span></li>
                                <li>1 Cinta adhesiva ecológica <span>🧵</span></li>
                                <li>Protección extra para tus muebles y objetos delicados</li>
                            </ul>
                            <div class="quantity-control">
                                <label for="qty-paq-premium">Cantidad:</label>
                                <select id="qty-paq-premium" class="product-qty form-control">
                                    <option value="" disabled selected>Selecciona</option>
                                    <option value="1">1</option>
                                </select>
                            </div>
                            <p class="price">$249.00 MXN <span>/día</span></p>
                            <button class="btn btn-primary add-to-cart-btn">Añadir al Carrito</button>
                        </div>
                    </div>

                    <!-- PRODUCTOS INDIVIDUALES -->
                    <!-- Caja HDPE 15kg (chica) -->
                    <div class="product-card" data-product-id="201" data-product-price="8.00">
                        <div class="badge">Caja Chica</div>
                        <div class="product-image" style="font-size:2.5rem;">🟩📦</div>
                        <div class="product-info">
                            <h3>Caja HDPE 15kg (chica)</h3>
                            <p class="description">
                                <span style="font-size:1.2em;">🔹</span> Fabricada en polietileno de alta densidad virgen (HDPE), con tapa.<br>
                                <span style="font-size:1.2em;">🛡️</span> Resistente, segura y ecológica.<br>
                                <span style="font-size:1.2em;">📏</span> Medidas: 50.3cm x 30.0cm x 21.0cm.<br>
                                <span style="font-size:1.2em;">⚡</span> Capacidad de carga: 15 kg. Color: Azul.
                            </p>
                            <ul class="product-features">
                                <li>Ideal para objetos medianos y mudanzas sostenibles <span>🌱</span></li>
                                <li>Con tapa para máxima protección <span>🔒</span></li>
                            </ul>
                            <div class="quantity-control">
                                <label for="qty-caja-chica">Cantidad:</label>
                                <select id="qty-caja-chica" class="product-qty form-control">
                                    <option value="" disabled selected>Selecciona</option>
                                    <option value="1">1</option>
                                    <option value="2">2</option>
                                    <option value="3">3</option>
                                    <option value="4">4</option>
                                    <option value="5">5</option>
                                    <option value="10">10</option>
                                </select>
                            </div>
                            <p class="price">$8.00 MXN <span>/día</span></p>
                            <button class="btn btn-primary add-to-cart-btn">Añadir al Carrito</button>
                        </div>
                    </div>
                    <!-- Caja Cozumel 20kg (mediana) -->
                    <div class="product-card" data-product-id="202" data-product-price="7.00">
                        <div class="badge">Caja Mediana</div>
                        <div class="product-image" style="font-size:2.5rem;">🟦📦</div>
                        <div class="product-info">
                            <h3>Caja Cozumel 20kg (mediana)</h3>
                            <p class="description">
                                <span style="font-size:1.2em;">🌊</span> Diseño adaptable para transportar y almacenar.<br>
                                <span style="font-size:1.2em;">🔹</span> Fabricada en HDPE virgen, color azul.<br>
                                <span style="font-size:1.2em;">📏</span> Medidas exteriores: 30x25x21 cm.<br>
                                <span style="font-size:1.2em;">⚡</span> Capacidad: 20 kg. Peso: 1.0695 kg.<br>
                                <span style="font-size:1.2em;">🛠️</span> Tapas dobles y orificios para seguros.<br>
                                <span style="font-size:1.2em;">🏷️</span> Área para colocar etiqueta o logotipo.
                            </p>
                            <ul class="product-features">
                                <li>Enfila para ahorro de espacio <span>📚</span></li>
                                <li>Ideal para objetos pequeños y delicados <span>🧩</span></li>
                            </ul>
                            <div class="quantity-control">
                                <label for="qty-caja-mediana">Cantidad:</label>
                                <select id="qty-caja-mediana" class="product-qty form-control">
                                    <option value="" disabled selected>Selecciona</option>
                                    <option value="1">1</option>
                                    <option value="2">2</option>
                                    <option value="3">3</option>
                                    <option value="4">4</option>
                                    <option value="5">5</option>
                                    <option value="10">10</option>
                                </select>
                            </div>
                            <p class="price">$7.00 MXN <span>/día</span></p>
                            <button class="btn btn-primary add-to-cart-btn">Añadir al Carrito</button>
                        </div>
                    </div>
                    <!-- Caja PP 30L (grande) -->
                    <div class="product-card" data-product-id="203" data-product-price="10.00">
                        <div class="badge">Caja Grande</div>
                        <div class="product-image" style="font-size:2.5rem;">🟥📦</div>
                        <div class="product-info">
                            <h3>Caja PP 30L (grande)</h3>
                            <p class="description">
                                <span style="font-size:1.2em;">💪</span> Material: Polipropileno, robusta y espaciosa.<br>
                                <span style="font-size:1.2em;">📏</span> Medidas: 58x39x19 cm.<br>
                                <span style="font-size:1.2em;">⚡</span> Capacidad de carga: 30 lts. Peso: 1.34 kg.<br>
                                <span style="font-size:1.2em;">🟦</span> Color tapa: Azul. Estiba: 4 piezas con producto.
                            </p>
                            <ul class="product-features">
                                <li>Ideal para objetos grandes y voluminosos <span>🧸</span></li>
                                <li>Gran resistencia y fácil manejo <span>🚚</span></li>
                            </ul>
                            <div class="quantity-control">
                                <label for="qty-caja-grande">Cantidad:</label>
                                <select id="qty-caja-grande" class="product-qty form-control">
                                    <option value="" disabled selected>Selecciona</option>
                                    <option value="1">1</option>
                                    <option value="2">2</option>
                                    <option value="3">3</option>
                                    <option value="4">4</option>
                                    <option value="5">5</option>
                                </select>
                            </div>
                            <p class="price">$10.00 MXN <span>/día</span></p>
                            <button class="btn btn-primary add-to-cart-btn">Añadir al Carrito</button>
                        </div>
                    </div>
                    <!-- Caja HDPE 10kg (alta) -->
                    <div class="product-card" data-product-id="204" data-product-price="7.00">
                        <div class="badge">Caja Alta</div>
                        <div class="product-image" style="font-size:2.5rem;">⬛📦</div>
                        <div class="product-info">
                            <h3>Caja HDPE 10kg (alta)</h3>
                            <p class="description">
                                <span style="font-size:1.2em;">🔹</span> Fabricada en polietileno de alta densidad virgen (HDPE), con tapa.<br>
                                <span style="font-size:1.2em;">📏</span> Medidas: 50.0cm x 30.0cm x 26.0cm.<br>
                                <span style="font-size:1.2em;">⚡</span> Capacidad de carga: 10 kg. Color: Azul.
                            </p>
                            <ul class="product-features">
                                <li>Ideal para objetos altos o frágiles <span>🍾</span></li>
                                <li>Durabilidad y protección superior <span>🛡️</span></li>
                            </ul>
                            <div class="quantity-control">
                                <label for="qty-caja-alta">Cantidad:</label>
                                <select id="qty-caja-alta" class="product-qty form-control">
                                    <option value="" disabled selected>Selecciona</option>
                                    <option value="1">1</option>
                                    <option value="2">2</option>
                                    <option value="3">3</option>
                                    <option value="4">4</option>
                                    <option value="5">5</option>
                                </select>
                            </div>
                            <p class="price">$7.00 MXN <span>/día</span></p>
                            <button class="btn btn-primary add-to-cart-btn">Añadir al Carrito</button>
                        </div>
                    </div>
                    <!-- Cinta adhesiva ecológica -->
                    <div class="product-card" data-product-id="205" data-product-price="30.00">
                        <div class="badge">Accesorio</div>
                        <div class="product-image" style="font-size:2.5rem;">🧵🌎</div>
                        <div class="product-info">
                            <h3>Cinta adhesiva ecológica</h3>
                            <p class="description">
                                <span style="font-size:1.2em;">♻️</span> 100% reciclable. Cuida el planeta mientras te mudas.<br>
                                <span style="font-size:1.2em;">🤲</span> Venta por unidad.
                            </p>
                            <ul class="product-features">
                                <li>Fácil de usar y resistente <span>✔️</span></li>
                            </ul>
                            <div class="quantity-control">
                                <label for="qty-cinta-eco">Cantidad:</label>
                                <select id="qty-cinta-eco" class="product-qty form-control">
                                    <option value="" disabled selected>Selecciona</option>
                                    <option value="1">1</option>
                                    <option value="2">2</option>
                                    <option value="3">3</option>
                                    <option value="4">4</option>
                                </select>
                            </div>
                            <p class="price">$30.00 MXN <span>/unidad</span></p>
                            <button class="btn btn-primary add-to-cart-btn">Añadir al Carrito</button>
                        </div>
                    </div>
                    <!-- Etiquetas para caja -->
                    <div class="product-card" data-product-id="206" data-product-price="2.00">
                        <div class="badge">Accesorio</div>
                        <div class="product-image" style="font-size:2.5rem;">🏷️🎨</div>
                        <div class="product-info">
                            <h3>Etiquetas para caja</h3>
                            <p class="description">
                                <span style="font-size:1.2em;">🔖</span> Identifica tus cajas fácilmente.<br>
                                <span style="font-size:1.2em;">🎨</span> Personalízalas como prefieras.
                            </p>
                            <ul class="product-features">
                                <li>Venta por unidad <span>🛒</span></li>
                            </ul>
                            <div class="quantity-control">
                                <label for="qty-etiquetas">Cantidad:</label>
                                <select id="qty-etiquetas" class="product-qty form-control">
                                    <option value="" disabled selected>Selecciona</option>
                                    <option value="5">5</option>
                                    <option value="10">10</option>
                                    <option value="20">20</option>
                                    <option value="30">30</option>
                                </select>
                            </div>
                            <p class="price">$2.00 MXN <span>/unidad</span></p>
                            <button class="btn btn-primary add-to-cart-btn">Añadir al Carrito</button>
                        </div>
                    </div>
                    <!-- Rollo de espuma protectora -->
                    <div class="product-card" data-product-id="207" data-product-price="45.00">
                        <div class="badge">Accesorio</div>
                        <div class="product-image" style="font-size:2.5rem;">🧽🛡️</div>
                        <div class="product-info">
                            <h3>Rollo de espuma protectora</h3>
                            <p class="description">
                                <span style="font-size:1.2em;">🛡️</span> Protección extra para objetos delicados.<br>
                                <span style="font-size:1.2em;">🧴</span> Venta por unidad.
                            </p>
                            <ul class="product-features">
                                <li>Evita daños en objetos frágiles <span>🧲</span></li>
                            </ul>
                            <div class="quantity-control">
                                <label for="qty-espuma">Cantidad:</label>
                                <select id="qty-espuma" class="product-qty form-control">
                                    <option value="" disabled selected>Selecciona</option>
                                    <option value="1">1</option>
                                    <option value="2">2</option>
                                    <option value="3">3</option>
                                </select>
                            </div>
                            <p class="price">$45.00 MXN <span>/unidad</span></p>
                            <button class="btn btn-primary add-to-cart-btn">Añadir al Carrito</button>
                        </div>
                    </div>
                    <!-- Cobija de mudanza -->
                    <div class="product-card" data-product-id="208" data-product-price="10.00">
                        <div class="badge">Accesorio</div>
                        <div class="product-image" style="font-size:2.5rem;">🧺🛏️</div>
                        <div class="product-info">
                            <h3>Cobija de mudanza</h3>
                            <p class="description">
                                <span style="font-size:1.2em;">🧺</span> Protege muebles y objetos grandes.<br>
                                <span style="font-size:1.2em;">🛏️</span> Renta por día.
                            </p>
                            <ul class="product-features">
                                <li>Suave y resistente <span>💪</span></li>
                                <li>Ideal para mudanzas seguras <span>🛡️</span></li>
                            </ul>
                            <div class="quantity-control">
                                <label for="qty-cobija">Cantidad:</label>
                                <select id="qty-cobija" class="product-qty form-control">
                                    <option value="" disabled selected>Selecciona</option>
                                    <option value="1">1</option>
                                    <option value="2">2</option>
                                    <option value="3">3</option>
                                </select>
                            </div>
                            <p class="price">$10.00 MXN <span>/día</span></p>
                            <button class="btn btn-primary add-to-cart-btn">Añadir al Carrito</button>
                        </div>
                    </div>
                    <!-- Diablito de carga -->
                    <div class="product-card" data-product-id="209" data-product-price="40.00">
                        <div class="badge">Accesorio</div>
                        <div class="product-image" style="font-size:2.5rem;">🛒🚀</div>
                        <div class="product-info">
                            <h3>Diablito de carga</h3>
                            <p class="description">
                                <span style="font-size:1.2em;">🛒</span> Facilita el movimiento de cajas y objetos pesados.<br>
                                <span style="font-size:1.2em;">🚀</span> Renta por día.
                            </p>
                            <ul class="product-features">
                                <li>Resistente y fácil de manejar <span>💪</span></li>
                                <li>Ideal para mudanzas rápidas <span>⚡</span></li>
                            </ul>
                            <div class="quantity-control">
                                <label for="qty-diablito">Cantidad:</label>
                                <select id="qty-diablito" class="product-qty form-control">
                                    <option value="" disabled selected>Selecciona</option>
                                    <option value="1">1</option>
                                    <option value="2">2</option>
                                </select>
                            </div>
                            <p class="price">$40.00 MXN <span>/día</span></p>
                            <button class="btn btn-primary add-to-cart-btn">Añadir al Carrito</button>
                        </div>
                    </div>
                </section>
            </main>
            <div class="cart-modal-overlay" id="cartModalOverlay">
                <div class="cart-modal">
                    <div class="cart-modal-header">
                        <h2>Tu Carrito</h2>
                        <button class="close-modal-btn" id="closeCartModalBtn">&times;</button>
                    </div>
                    <div class="cart-modal-body" id="cartItemsContainer"></div>
                    <div class="cart-modal-footer">
                        <div class="cart-summary">
                            <div class="cart-rental-dates" style="display: none; padding-bottom: 1rem; border-bottom: 1px dashed #ccc; margin-bottom: 1rem;">
                                <p><strong>Entrega:</strong> <span id="cartStartDate">--</span></p>
                                <p><strong>Recolección:</strong> <span id="cartEndDate">--</span></p>
                            </div>
                            <p>Subtotal: <span id="cartSubtotal">$0.00</span></p>
                            <p>Impuestos (16%): <span id="cartTaxes">$0.00</span></p>
                            <h3>Total: <span id="cartTotal">$0.00</span></h3>
                        </div>
                        <div class="cart-footer-buttons">
                            <button class="btn btn-secondary empty-cart-btn" id="emptyCartBtn">Vaciar Carrito</button>
                            <a href="confirmacion-entrega-recoleccion.html" class="btn btn-primary proceed-to-checkout-btn" id="proceedToCheckoutBtn">Finalizar Compra</a>
                        </div>
                    </div>
                </div>
            </div>
            <div class="cart-notification" id="cartNotification">
                <div class="notification-content">
                    <div class="notification-icon-wrapper"><span class="notification-icon"></span></div>
                    <p id="notificationText"></p>
                </div>
            </div>
            <footer class="footer">
                <div class="container footer-content">
                    <div class="footer-info">
                        <h3>greenhauL</h3>
                        <p>Mudanzas sostenibles, sin complicaciones.</p>
                        <p><i class="fas fa-phone-alt"></i> +52 56 5569 0681</p>
                        <p><i class="fas fa-envelope"></i> soporte@greenhauL.com.mx</p>
                        <p><i class="fas fa-map-marker-alt"></i> Ciudad de México</p>
                    </div>
                    <div class="footer-links">
                        <h3>Enlaces Rápidos</h3>
                        <ul>
                            <li><a href="index.html">Inicio</a></li>
                            <li><a href="productos.html">Productos</a></li>
                            <li><a href="servicios.html">Servicios</a></li>
                            <li><a href="nosotros.html">Nosotros</a></li>
                            <li><a href="contacto.html">Contacto</a></li>
                            <li><a href="cuenta.html">Mi Cuenta</a></li>
                        </ul>
                    </div>
                    <div class="footer-social-links">
                        <h3>Síguenos</h3>
                        <div class="social-icons-wrapper">
                            <a href="https://facebook.com/greenhaulmx" class="social-icon" aria-label="Facebook" target="_blank"><i class="fab fa-facebook-f"></i></a>
                            <a href="https://instagram.com/greenhaulmx" class="social-icon" aria-label="Instagram" target="_blank"><i class="fab fa-instagram"></i></a>
                            <a href="https://twitter.com/greenhaulmx" class="social-icon" aria-label="Twitter" target="_blank"><i class="fab fa-twitter"></i></a>
                        </div>
                    </div>
                </div>
                <div class="footer-bottom">
                    &copy; <span id="current-year"></span> greenhauL. Todos los derechos reservados.
                </div>
            </footer>
            <script>
                document.addEventListener('DOMContentLoaded', () => {
                    const yearSpan = document.getElementById('current-year');
                    if (yearSpan) yearSpan.textContent = new Date().getFullYear();
                });
            </script>
            <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
            <script src="https://npmcdn.com/flatpickr/dist/l10n/es.js"></script>
            <!-- Asegúrate que main.js se carga ANTES que tu script de productos para que window.showNotification y window.addToCart estén disponibles -->
            <script type="module" src="/assets/js/main.js"></script>
            <script>
                document.addEventListener('DOMContentLoaded', () => {
                    function updateRentalDatesInCart() {
                        const startDateInput = document.getElementById('fecha-entrega');
                        const endDateInput = document.getElementById('fecha-recoleccion');
                        const start = startDateInput.value;
                        const end = endDateInput.value;
                        if (start && end) {
                            let cart = JSON.parse(localStorage.getItem('shoppingCart')) || { items: [] };
                            cart.rentalDates = { start, end };
                            const startDate = new Date(start);
                            const endDate = new Date(end);
                            cart.totalDays = Math.max(Math.round((endDate - startDate) / (1000 * 60 * 60 * 24)), 1);
                            localStorage.setItem('shoppingCart', JSON.stringify(cart));
                        }
                    }
                    document.getElementById('fecha-entrega').addEventListener('change', updateRentalDatesInCart);
                    document.getElementById('fecha-recoleccion').addEventListener('change', updateRentalDatesInCart);
        
                    // Si ya hay fechas, rellena los inputs
                    const cart = JSON.parse(localStorage.getItem('shoppingCart')) || {};
                    if (cart.rentalDates) {
                        document.getElementById('fecha-entrega').value = cart.rentalDates.start || '';
                        document.getElementById('fecha-recoleccion').value = cart.rentalDates.end || '';
                    }
                });
            </script>
            <!-- VALIDACIÓN DE DISPONIBILIDAD Y AGREGAR AL CARRITO -->
            <script>
                document.addEventListener('DOMContentLoaded', function() {
                    const addToCartButtons = document.querySelectorAll('.add-to-cart-btn');
                    addToCartButtons.forEach(function(btn) {
                        btn.addEventListener('click', async function(e) {
                            e.preventDefault();
        
                            const productCard = btn.closest('.product-card');
                            const productId = productCard.getAttribute('data-product-id');
                            const productName = productCard.querySelector('.product-info h3').textContent.trim();
                            const quantitySelect = productCard.querySelector('.product-qty');
                            const quantity = parseInt(quantitySelect.value);
                            const productPrice = parseFloat(productCard.getAttribute('data-product-price'));
        
                            const startDateInput = document.getElementById('fecha-entrega');
                            const endDateInput = document.getElementById('fecha-recoleccion');
                            const fechaInicio = startDateInput.value;
                            const fechaFin = endDateInput.value;
        
                            // Validaciones iniciales
                            if (!fechaInicio || !fechaFin) {
                                window.showNotification("Selecciona primero las fechas de renta.", "error");
                                return;
                            }
                            if (!quantity || isNaN(quantity)) {
                                window.showNotification("Selecciona la cantidad del producto.", "error");
                                return;
                            }
        
                            try {
                                btn.disabled = true;
                                btn.classList.add('loading');
                                const url = `/api/products/${productId}/availability?fecha_inicio=${fechaInicio}&fecha_fin=${fechaFin}&cantidad=${quantity}`;
                                const res = await fetch(url);
        
                                if (!res.ok) {
                                    btn.disabled = false;
                                    btn.classList.remove('loading');
                                    window.showNotification("No se pudo verificar la disponibilidad. Intenta de nuevo.", "error");
                                    return;
                                }
        
                                const data = await res.json();
        
                                btn.disabled = false;
                                btn.classList.remove('loading');
        
                                if (typeof data.disponible === "undefined") {
                                    window.showNotification("Respuesta inesperada del servidor. Intenta de nuevo.", "error");
                                    return;
                                }
        
                                if (!data.disponible) {
                                    window.showNotification(`Cantidad no disponible, stock disponible: ${data.cantidad_maxima}. Intenta con menos cantidad o selecciona otras fechas.`, "error");
                                    return;
                                }
        
                                // Solo aquí se agrega al carrito, usando la función global de main.js
                                window.addToCart(productId, productName, quantity, productPrice);
                                window.showNotification("Producto añadido al carrito.", "success");
                            } catch (err) {
                                btn.disabled = false;
                                btn.classList.remove('loading');
                                window.showNotification("No se pudo verificar la disponibilidad. Intenta de nuevo.", "error");
                            }
                        });
                    });
                });
            </script>
        </body>
        </html>